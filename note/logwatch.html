<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logwatch简单配置教程 - 小V吃鱼卡到了</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="http://www.zhuimengle.com/theme/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="http://www.zhuimengle.com/theme/css/niu2.min.css" type="text/css" />

    <link rel="canonical" href="http://www.zhuimengle.com/note/logwatch.html" />
    
    <script type="text/javascript">window.onload=function(){};</script>
    <!--[if lt IE 9]>
        <script src="http://www.zhuimengle.com/theme/js/html5shiv.js"></script>
        <script src="http://www.zhuimengle.com/theme/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body> 
    <div id="body-header">
<div class="navbar navbar-inverse navbar-fixed-top">
<div class="col-md-12">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.zhuimengle.com">
            <i class="fa fa-home"></i>小V吃鱼卡到了
        </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
            <li><a href="/about.html" title="about me">
                <i class="fa fa-anchor"></i>关于</a>
            </li>
            <li><a href="/archives.html" title="blog archives">
                <i class="fa fa-archive"></i>存档</a>
            </li>
            <li><a href="/tag/" title="blog tags">
                <i class="fa fa-tag"></i>标签</a>
            </li>
        <!-- category dropdown list -->
        <li class="dropdown">
           <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-folder-open"></i>分类<b class="caret"></b>
           </a>
           <ul class="dropdown-menu">
               <li><a href="http://www.zhuimengle.com/note/index.html">
                      <i class="fa fa-book"></i>印象-笔记
                      (88)</a></li>
               <li><a href="http://www.zhuimengle.com/research/index.html">
                      <i class="fa fa-flask"></i>实验室
                      (2)</a></li>
           </ul>
        </li>
        <!--  self defined dropdown list -->
        </ul>
        
        <!-- right nav bar -->
        <ul class="nav navbar-nav navbar-right">
        <!-- google custom search -->
       </ul>
    </nav>
</div>
</div>    </div>
    
    <div id="body-content">
<div class="col-md-8 col-md-offset-2">
    <h1 id="content-heading">Logwatch简单配置教程</h1>
</div>
<div id="niu2-left-container" class="col-md-6 col-md-offset-2 with-right-border">
    <div id="niu2-main-content">
        <p>简要介绍Debian/Ubuntu和CentOS上logwatch的配置方法和常见错误，详细的配置教程见<a href="#35808e79fa5f367a06c83a78b857519c">参考资料</a>。</p>
<h2 id="28623715340b3530527f618f364b309a">配置文件说明</h2>
<p>Debian/Ubuntu上logwatch配置目录的结构如下:</p>
<div class="codehilite"><pre>/etc/logwatch/
    conf/             # 配置目录
        logfiles/         # logwatch日志文件组(*.conf)
        services/         # logwatch日志服务(*.conf)
    scripts/          # 可执行脚本
        logfiles/         # 可包含多个logwatch日志文件组的子目录，对应的logwatch日志服务运行时，子目录下的脚本会自动被调用
        services/         # logwatch日志服务的脚本
        shared/           # 可被多个logwatch日志服务引用的脚本
    logwatch.conf     # 主配置文件
</pre></div>


<p>CentOS的logwatch.conf位于/etc/logwatch/conf目录下。</p>
<h2 id="7b66081cfa5cfc0d768814ee42db686d">例解logwatch配置步骤</h2>
<p>用一个简单的例子说明添加logwatch监控的步骤，详细的配置教程见<a href="#35808e79fa5f367a06c83a78b857519c">参考资料</a>。</p>
<h3 id="e32541051da412ea506a74f7cd75b065">创建logwatch日志文件组</h3>
<p>用一个简单的例子介绍logwatch的配置方法。首先创建logwatch日志文件组配置文件<code>/etc/logwatch/conf/logfiles/test.conf</code>:</p>
<div class="codehilite"><pre>LogFile = /path/to/your/logfile
LogFile = /path/to/your/second/logfile
</pre></div>


<h3 id="a2837464c356ea9bc64fa73409a3cc44">创建logwatch服务过滤器</h3>
<p>然后，创建logwatch服务配置文件<code>/etc/logwatch/conf/services/test.conf</code>:</p>
<div class="codehilite"><pre>Title = test title     # 日志文件里的标题
LogFile = test   # logwatch日志文件组的名字，通常是对应的配置文件的文件名部分
</pre></div>


<h3 id="95cfc55095b1d02b1d421a5e461626e4">创建logwatch服务过滤器脚本</h3>
<p>创建logwatch服务的过滤器脚本<code>/etc/logwatch/scripts/services/test</code>:</p>
<div class="codehilite"><pre><span class="c">#!/bin/bash</span>

grep -i ERROR
</pre></div>


<p>上面的脚本会从日志文件里过滤出包含<code>ERROR</code>的行。最后，为新建的脚本添加执行权限:</p>
<div class="codehilite"><pre>chmod +x /etc/logwatch/scripts/services/test
</pre></div>


<h2 id="3fc23d0f62d51a3d454e0d9948a28cf0">主配置文件logwatch.conf</h2>
<p>在logwatch.conf里添加或修改如下选项可以将监控报告以html的格式发送到你的邮箱里。</p>
<div class="codehilite"><pre>Output = html                # 生成html格式的报告
MailTo = your_email_address  # 定义你的邮箱地址
</pre></div>


<h2 id="1f7cbf0037439af3d22b096a0360001e">常见错误解决</h2>
<p>记录logwatch常见错误的解决方法。</p>
<h3 id="040727b4d83191c0fdfe019d0b93bd65">无法发送邮件</h3>
<p>CentOS5.4上使用sendmail发送邮件。正常运行一段时间后，突然不再发送邮件。检查后发现，配置一切正常，可以手动发邮件，使用logwatch的<code>--print</code>选项输出正常。</p>
<p>最后在<code>logwatch --print</code>的输出里发现如下信息:</p>
<div class="codehilite"><pre>Large Mailbox threshold: 40MB (41943040 bytes)
  Warning: Large mailbox: root (257959878)
</pre></div>


<p>解决办法是清空旧的mailbox(/var/spool/mail/root)或将mailbox上限调大。参考<a href="http://haprakjingga.wordpress.com/2008/07/11/setting-sendmail-largeboxes-in-logwatch-report/">这里</a>的方法，将<code>/usr/share/logwatch/default.conf/services/sendmail-largeboxes.conf</code>的<code>sendmail_largeboxes_size</code>变量设置的大一些即可。</p>
<h2 id="81f5d554d30e82d475ed29a45a7c4277">阅读资料</h2>
<ul>
<li><a href="http://web.archive.org/web/20080822051428/http://www.logwatch.org/tabs/docs/HOWTO-Customize-LogWatch.html">HOWTO Customize LogWatch</a></li>
<li><a href="http://tuxradar.com/content/managing-your-log-files">Managing your log files</a></li>
<li><a href="http://en.gentoo-wiki.com/wiki/Logwatch_with_Metalog">Logwatch with metalog</a></li>
<li><a href="http://haprakjingga.wordpress.com/2008/07/11/setting-sendmail-largeboxes-in-logwatch-report/">Setting sendmail-largeboxes in logwatch report</a></li>
</ul>
    </div>
    <div id="content-comments">
<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
<script type="text/javascript">var duoshuoQuery={short_name:"vic-story"};(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=(document.location.protocol=="https:"?"https:":"http:")+"//static.duoshuo.com/embed.js";a.charset="UTF-8";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})();</script>
<!-- Duoshuo Comment END --></div>

</div>
<div class="niu2-right-container col-md-2">
    <div id="niu2-sidebar-meta" class="niu2-sidebar">
        <div class="niu2-sidebar-label"><i class="fa fa-calendar"></i>发布时间:</div>
        <div class="niu2-sidebar-value">2013-08-25 12:14</div>
        <div class="niu2-sidebar-label"><i class="fa fa-pencil" style="font-size: 1.05em;"></i>最后修改:</div>
        <div class="niu2-sidebar-value">2013-12-02 13:17</div>
        <div class="niu2-sidebar-label"><i class="fa fa-book"></i>分类:</div>
        <div class="niu2-sidebar-value"><a href="http://www.zhuimengle.com/note/index.html">印象-笔记</a></div>
        <div class="niu2-sidebar-label"><i class="fa fa-tag"></i>标签:</div>
 
            <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://www.zhuimengle.com/tag/logwatch.html">logwatch</a><sup>1</sup></div>
            <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://www.zhuimengle.com/tag/security.html">security</a><sup>3</sup></div>
            <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://www.zhuimengle.com/tag/debian.html">debian</a><sup>8</sup></div>
            <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://www.zhuimengle.com/tag/jiao-cheng.html">教程</a><sup>13</sup></div>
    </div>
</div>

<div class="niu2-right-container col-md-3">
    <div id="niu2-sidebar-toc" class="niu2-sidebar" data-status="closed">
        <div class="niu2-sidebar-label">
            <i id="niu2-sidebar-toc-ctrl" class="fa fa-plus"></i>目录
        </div>
        <ol id="niu2-sidebar-toc-list">
            <li><a href="#content-heading">Logwatch简单配置教程</a></li>
            <li><a href='#28623715340b3530527f618f364b309a'>配置文件说明</a></li><li><a href='#7b66081cfa5cfc0d768814ee42db686d'>例解logwatch配置步骤</a><ol><li><a href='#e32541051da412ea506a74f7cd75b065'>创建logwatch日志文件组</a></li><li><a href='#a2837464c356ea9bc64fa73409a3cc44'>创建logwatch服务过滤器</a></li><li><a href='#95cfc55095b1d02b1d421a5e461626e4'>创建logwatch服务过滤器脚本</a></li></ol></li><li><a href='#3fc23d0f62d51a3d454e0d9948a28cf0'>主配置文件logwatch.conf</a></li><li><a href='#1f7cbf0037439af3d22b096a0360001e'>常见错误解决</a><ol><li><a href='#040727b4d83191c0fdfe019d0b93bd65'>无法发送邮件</a></li></ol></li><li><a href='#81f5d554d30e82d475ed29a45a7c4277'>阅读资料</a></li>
            <li><a href="#content-comments">评论</a></li>
        </ol>
    </div>
</div>
    </div>

    <div id="body-footer" class="col-md-6 col-md-offset-2">
<div class="niu2-footer">
    <hr/>
	<p>
		Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>, 
        <a href="https://github.com/mawenbao/niu-x2-sidebar">theme</a> built with <a href="http://getbootstrap.com">Bootstrap3</a>
		by <a href="http://blog.atime.me">Ma Wenbao</a>, icons by 
		<a href="http://fortawesome.github.io/Font-Awesome">Font Awesome</a>.
	</p>
	<p>
		©
				2009-2014
		<a class="niu2-footer-link" href="http://www.zhuimengle.com">vk</a>
    </p>
    <p class="niu2-icons">
	        <a class="niu2-footer-icon" href="/my_gnupg.html" title="my public key">
	            <i class="fa fa-key fa-lg"></i>
	        </a>
	        <a class="niu2-footer-icon" href="V: dolphinzhang1987@gmail.com" title="my email address">
	            <i class="fa fa-envelope-o fa-lg"></i>
	        </a>
	        <a class="niu2-footer-icon" href="https://github.com/vickyi" title="my github page">
	            <i class="fa fa-github-alt fa-lg"></i>
	        </a>
	        <a class="niu2-footer-icon" href="/feed.xml" title="subscribe my blog">
	            <i class="fa fa-rss fa-lg"></i>
	        </a>
	</p>
</div>    </div>
    
    <div id="niu2-pygments" data-theme="github"></div>

    <script type="text/javascript" src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="http://www.zhuimengle.com/theme/js/niu2.min.js"></script>
    <script type="text/javascript" src="http://www.zhuimengle.com/theme/js/bootstrap.min.js"></script>
    <script type="text/javascript">onContentLoaded();</script>
  </body>
</html>